<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ln-111-project-docs-creator - State Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="../shared/css/diagram.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Project Documentation Creator</h1>
            <p class="subtitle">ln-111-project-docs-creator - State Diagram</p>
        </header>

        <div class="info-box">
            <h3>Workflow Overview</h3>
            <ul>
                <li><strong>Purpose:</strong> Create complete project documentation (11 docs: 4 root + 3-7 project)</li>
                <li><strong>Worker for:</strong> ln-110-documents-pipeline orchestrator</li>
                <li><strong>Phases:</strong> 5 phases (GATHER CONTEXT -> CREATE -> VALIDATE STRUCTURE -> VALIDATE CONTENT -> FINALIZE)</li>
                <li><strong>Context First:</strong> Auto-discovery + Materials + MCP Research BEFORE user questions</li>
                <li><strong>Populated Docs:</strong> Documents created with actual content, not empty placeholders</li>
            </ul>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #BBDEFB; border-color: #1565C0;"></div>
                <span>Context Gathering</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-action"></div>
                <span>Creation Action</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-decision"></div>
                <span>Conditional Check</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-success"></div>
                <span>Success State</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-validation"></div>
                <span>Validation</span>
            </div>
        </div>

        <div class="diagram-container">
            <div class="mermaid">
graph TD
    Start([Start: Project Docs Creation]) --> Phase10[Phase 1.0: Context Gathering]

    %% Phase 1.0: Context Gathering (NEW)
    Phase10 --> AutoDiscovery[Auto-Discovery:<br/>package.json, docker-compose,<br/>src/, migrations/]
    AutoDiscovery --> MaterialsRequest{User has<br/>materials?}
    MaterialsRequest -->|Yes| ReadMaterials[Extract from<br/>user docs]
    MaterialsRequest -->|No| MCPResearch
    ReadMaterials --> MCPResearch[MCP Research:<br/>Context7, Ref]
    MCPResearch --> CheckGaps{Gaps<br/>remaining?}
    CheckGaps -->|Yes| AskQuestions[Ask ONLY<br/>remaining questions]
    CheckGaps -->|No| ContextStore
    AskQuestions --> ContextStore[Build Context Store:<br/>all placeholders filled]

    %% Phase 1.1: Root Docs (with populated content)
    ContextStore --> Phase1Root[Phase 1.1: Root Documentation]
    Phase1Root --> CheckClaude{CLAUDE.md<br/>exists?}
    CheckClaude -->|Yes| CheckLink{Has docs link?}
    CheckClaude -->|No| CreateClaude[Create CLAUDE.md<br/>from Context Store]
    CheckLink -->|Yes| CreateRootDocs[Create remaining root docs]
    CheckLink -->|No| AddLink[Add docs link]
    CreateClaude --> CreateRootDocs
    AddLink --> CreateRootDocs

    CreateRootDocs --> CreateReadme[docs/README.md<br/>populated]
    CreateReadme --> CreateStandards[documentation_standards.md]
    CreateStandards --> CreatePrinciples[principles.md]

    %% Phase 1.2: Project Docs (with populated content)
    CreatePrinciples --> Phase1Project[Phase 1.2: Project Documentation]
    Phase1Project --> ScanExisting[Scan docs/project/*.md]
    ScanExisting --> DetectType{Detect from<br/>Context Store}

    DetectType --> CreateRequired[Create populated:<br/>requirements.md<br/>architecture.md<br/>tech_stack.md]

    CreateRequired --> CheckBackend{hasBackend?}
    CheckBackend -->|Yes| CreateAPI[Create api_spec.md<br/>populated]
    CheckBackend -->|No| CheckDB

    CreateAPI --> CheckDB{hasDatabase?}
    CheckDB -->|Yes| CreateDBSchema[Create database_schema.md<br/>populated]
    CheckDB -->|No| CheckFrontend

    CreateDBSchema --> CheckFrontend{hasFrontend?}
    CheckFrontend -->|Yes| CreateDesign[Create design_guidelines.md<br/>populated]
    CheckFrontend -->|No| CheckDocker

    CreateDesign --> CheckDocker{hasDocker?}
    CheckDocker -->|Yes| CreateRunbook[Create runbook.md<br/>populated]
    CheckDocker -->|No| Phase2

    CreateRunbook --> Phase2

    %% Phase 2: Validate Structure
    Phase2[Phase 2: Validate Structure] --> ValidateScope[Check SCOPE tags]
    ValidateScope --> ValidateSections[Check required sections]
    ValidateSections --> ValidateMaintenance[Check Maintenance sections]
    ValidateMaintenance --> ValidatePOSIX[Check POSIX endings]
    ValidatePOSIX --> Phase3

    %% Phase 3: Validate Content (validation-only)
    Phase3[Phase 3: Validate Content] --> LoadQuestions[Load questions.md<br/>48 questions]
    LoadQuestions --> ValidateLoop[For each question:]

    ValidateLoop --> CheckHeuristics{Heuristics pass?}
    CheckHeuristics -->|Yes| NextQuestion[Next question]
    CheckHeuristics -->|No| MarkWarning[Mark as WARNING]

    MarkWarning --> CheckTBD{TBD marker?}
    CheckTBD -->|Yes| LogTBD[Log: needs manual input]
    CheckTBD -->|No| LogError[ERROR: empty placeholder]
    LogTBD --> NextQuestion
    LogError --> NextQuestion
    NextQuestion --> MoreQuestions{More questions?}
    MoreQuestions -->|Yes| ValidateLoop
    MoreQuestions -->|No| TBDResolution

    TBDResolution{TBD items<br/>found?}
    TBDResolution -->|Yes| AskComplete[Ask: Complete now?]
    TBDResolution -->|No| Phase4
    AskComplete -->|Yes| FillTBD[Fill TBD items]
    AskComplete -->|No| Phase4
    FillTBD --> Phase4

    %% Phase 4: Finalize
    Phase4[Phase 4: Finalization] --> Summary[Generate summary:<br/>Context: X auto, Y materials,<br/>Z MCP, W questions]
    Summary --> End([End: 11 docs populated + validated])

    %% Styling
    classDef action fill:#C8E6C9,stroke:#388E3C,stroke-width:2px
    classDef decision fill:#FFE0B2,stroke:#E64A19,stroke-width:2px
    classDef success fill:#B3E5FC,stroke:#0277BD,stroke-width:2px
    classDef validation fill:#E1BEE7,stroke:#7B1FA2,stroke-width:2px
    classDef context fill:#BBDEFB,stroke:#1565C0,stroke-width:2px

    class Phase1Root,Phase1Project,CreateClaude,CreateRootDocs,CreateReadme,CreateStandards,CreatePrinciples,ScanExisting,CreateRequired,CreateAPI,CreateDBSchema,CreateDesign,CreateRunbook,AddLink action
    class CheckClaude,CheckLink,DetectType,CheckBackend,CheckDB,CheckFrontend,CheckDocker,CheckHeuristics,MoreQuestions,MaterialsRequest,CheckGaps,CheckTBD,TBDResolution decision
    class End success
    class Phase2,Phase3,Phase4,ValidateScope,ValidateSections,ValidateMaintenance,ValidatePOSIX,LoadQuestions,ValidateLoop,MarkWarning,LogTBD,LogError,NextQuestion,Summary,AskComplete,FillTBD validation
    class Phase10,AutoDiscovery,ReadMaterials,MCPResearch,AskQuestions,ContextStore context
            </div>
        </div>

        <div class="info-box">
            <h3>Key Features</h3>
            <ul>
                <li><strong>Context First:</strong> Gather ALL data (auto-discovery, materials, MCP) BEFORE asking user questions</li>
                <li><strong>Populated Templates:</strong> Documents created with actual project content, not empty placeholders</li>
                <li><strong>Auto-Discovery:</strong> package.json, docker-compose.yml, src/, migrations/, .env.example</li>
                <li><strong>MCP Research:</strong> Context7 and Ref for library versions and best practices</li>
                <li><strong>TBD Pattern:</strong> Missing data marked as [TBD: placeholder] for later completion</li>
                <li><strong>Question Reduction:</strong> 70-90% fewer interactive questions vs traditional approach</li>
            </ul>
        </div>

        <footer>
            <p>Generated for ln-111-project-docs-creator skill | Version 1.1.0</p>
            <p>Diagram format: Mermaid.js | Last updated: 2025-12-18</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>
